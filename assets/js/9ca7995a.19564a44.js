"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[52987],{69879:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"testing/integration-testing","title":"Integration Testing","description":"Per-package unit tests (see Test Infrastructure) verify individual packages in isolation. Integration tests go further \u2014 they deploy a full game that depends on many packages, upload it to Roblox, and run a smoke test to confirm everything boots together. This catches problems that unit tests miss: incompatible package versions, missing dependencies, and broken service initialization order.","source":"@site/docs/testing/integration-testing.md","sourceDirName":"testing","slug":"/testing/integration-testing","permalink":"/NevermoreEngine/docs/testing/integration-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/Quenty/NevermoreEngine/edit/main/docs/testing/integration-testing.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Integration Testing","sidebar_position":2},"sidebar":"defaultSidebar","previous":{"title":"Test Infrastructure","permalink":"/NevermoreEngine/docs/testing/"},"next":{"title":"Conventions","permalink":"/NevermoreEngine/docs/conventions/"}}');var r=t(74848),i=t(28453);const o={title:"Integration Testing",sidebar_position:2},a="Integration testing",d={},l=[{value:"When to use integration tests",id:"when-to-use-integration-tests",level:2},{value:"Quick start",id:"quick-start",level:2},{value:"Setting up a new integration game",id:"setting-up-a-new-integration-game",level:2},{value:"1. Create the game directory",id:"1-create-the-game-directory",level:3},{value:"2. Add a Rojo project file",id:"2-add-a-rojo-project-file",level:3},{value:"3. Add a deploy config",id:"3-add-a-deploy-config",level:3},{value:"4. Add entry scripts",id:"4-add-entry-scripts",level:3},{value:"Running deploys",id:"running-deploys",level:2},{value:"Single game",id:"single-game",level:3},{value:"Batch deploy",id:"batch-deploy",level:3},{value:"Merging with an existing place (basePlace)",id:"merging-with-an-existing-place-baseplace",level:2},{value:"How the merge works",id:"how-the-merge-works",level:3},{value:"Credential requirements",id:"credential-requirements",level:3},{value:"Smoke testing",id:"smoke-testing",level:3},{value:"CI integration",id:"ci-integration",level:2},{value:"Posting deploy results to a PR",id:"posting-deploy-results-to-a-pr",level:3},{value:"Automatic discovery",id:"automatic-discovery",level:3},{value:"Luau template convention",id:"luau-template-convention",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"integration-testing",children:"Integration testing"})}),"\n",(0,r.jsxs)(n.p,{children:["Per-package unit tests (see ",(0,r.jsx)(n.a,{href:"/NevermoreEngine/docs/testing/",children:"Test Infrastructure"}),") verify individual packages in isolation. Integration tests go further \u2014 they deploy a full game that depends on many packages, upload it to Roblox, and run a smoke test to confirm everything boots together. This catches problems that unit tests miss: incompatible package versions, missing dependencies, and broken service initialization order."]}),"\n",(0,r.jsx)(n.h2,{id:"when-to-use-integration-tests",children:"When to use integration tests"}),"\n",(0,r.jsx)(n.p,{children:"Integration tests are useful when you have a game or experience that pulls in multiple Nevermore packages and you want to verify the whole thing works on every PR. Typical use cases:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A production game that depends on dozens of packages \u2014 catch regressions before merging"}),"\n",(0,r.jsx)(n.li,{children:"A dedicated test game that exercises specific package combinations together"}),"\n",(0,r.jsx)(n.li,{children:"A team-create place where artists build content and code is deployed separately"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"quick-start",children:"Quick start"}),"\n",(0,r.jsxs)(n.p,{children:["If you already have a Roblox universe and place set up, the minimum setup is four files in a directory under ",(0,r.jsx)(n.code,{children:"games/"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"games/my-game/\n\u251c\u2500\u2500 package.json               # So pnpm discovers the workspace\n\u251c\u2500\u2500 deploy.nevermore.json       # Tells the CLI where to deploy\n\u251c\u2500\u2500 default.project.json        # Rojo project that maps code into the place\n\u2514\u2500\u2500 scripts/\n    \u2514\u2500\u2500 Server/\n        \u2514\u2500\u2500 ServerMain.server.lua   # Entry point that runs in Roblox\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then deploy with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"nevermore deploy run\n"})}),"\n",(0,r.jsx)(n.p,{children:"The rest of this guide walks through each file and the available options."}),"\n",(0,r.jsx)(n.h2,{id:"setting-up-a-new-integration-game",children:"Setting up a new integration game"}),"\n",(0,r.jsx)(n.h3,{id:"1-create-the-game-directory",children:"1. Create the game directory"}),"\n",(0,r.jsxs)(n.p,{children:["Create a directory under ",(0,r.jsx)(n.code,{children:"games/"})," and add a ",(0,r.jsx)(n.code,{children:"package.json"})," so pnpm includes it in the workspace. List the Nevermore packages your game depends on:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "name": "@quenty/my-game",\n  "version": "1.0.0",\n  "private": true,\n  "dependencies": {\n    "@quenty/loader": "workspace:*",\n    "@quenty/servicebag": "workspace:*",\n    "@quenty/maid": "workspace:*"\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Then run ",(0,r.jsx)(n.code,{children:"pnpm install"})," from the repo root so the dependencies are linked."]}),"\n",(0,r.jsx)(n.h3,{id:"2-add-a-rojo-project-file",children:"2. Add a Rojo project file"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"default.project.json"})," maps your game's code into the Roblox DataModel. Here's an example from the built-in integration game:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "name": "MyGameTest",\n  "tree": {\n    "$className": "DataModel",\n    "ServerScriptService": {\n      "$properties": {\n        "LoadStringEnabled": true\n      },\n      "mygame": {\n        "$className": "Folder",\n        "game": {\n          "$path": "modules"\n        },\n        "node_modules": {\n          "$path": "node_modules"\n        }\n      },\n      "Script": {\n        "$path": "scripts/Server"\n      }\n    },\n    "StarterPlayer": {\n      "StarterPlayerScripts": {\n        "Main": {\n          "$path": "scripts/Client"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"LoadStringEnabled"})," must be ",(0,r.jsx)(n.code,{children:"true"})," because the smoke test executes code via Open Cloud's Luau execution API."]}),"\n",(0,r.jsx)(n.h3,{id:"3-add-a-deploy-config",children:"3. Add a deploy config"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"deploy.nevermore.json"})," with a ",(0,r.jsx)(n.code,{children:"test"})," target pointing to your Roblox universe and place:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "targets": {\n    "test": {\n      "universeId": 12345,\n      "placeId": 67890,\n      "project": "default.project.json"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"4-add-entry-scripts",children:"4. Add entry scripts"}),"\n",(0,r.jsxs)(n.p,{children:["Add a server entry point at ",(0,r.jsx)(n.code,{children:"scripts/Server/ServerMain.server.lua"})," that bootstraps the loader:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-luau",children:'local ServerScriptService = game:GetService("ServerScriptService")\n\nlocal loader = ServerScriptService:FindFirstChild("LoaderUtils", true).Parent\nlocal require = require(loader).bootstrapGame(ServerScriptService.mygame)\n\nlocal ServiceBag = require("ServiceBag")\n\nlocal serviceBag = ServiceBag.new()\nserviceBag:GetService(require("MyService"))\n-- ... register services\nserviceBag:Init()\nserviceBag:Start()\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"mygame"})," with the key used in your Rojo project tree."]}),"\n",(0,r.jsx)(n.h2,{id:"running-deploys",children:"Running deploys"}),"\n",(0,r.jsx)(n.h3,{id:"single-game",children:"Single game"}),"\n",(0,r.jsx)(n.p,{children:"From the game directory:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Deploy to the test target (default)\nnevermore deploy run\n\n# Deploy and publish (makes the version live in-game)\nnevermore deploy run --publish\n\n# Deploy a specific target\nnevermore deploy run staging\n\n# Show build and upload logs\nnevermore deploy run --logs\n"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Flag"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--publish"})}),(0,r.jsx)(n.td,{children:"Publish the place (default: saved as draft)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--api-key"})}),(0,r.jsx)(n.td,{children:"Roblox Open Cloud API key"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--universe-id"})}),(0,r.jsx)(n.td,{children:"Override universe ID from config"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--place-id"})}),(0,r.jsx)(n.td,{children:"Override place ID from config"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--place-file"})}),(0,r.jsxs)(n.td,{children:["Upload a pre-built ",(0,r.jsx)(n.code,{children:".rbxl"})," instead of building via rojo"]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"batch-deploy",children:"Batch deploy"}),"\n",(0,r.jsx)(n.p,{children:"Deploy multiple games at once, with automatic change detection:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Deploy only games affected by changes vs origin/main\nnevermore batch deploy\n\n# Deploy all games with deploy targets\nnevermore batch deploy --all\n\n# Control parallelism\nnevermore batch deploy --concurrency 3\n\n# Write JSON results to a file (for CI)\nnevermore batch deploy --output results.json\n"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Flag"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--all"})}),(0,r.jsx)(n.td,{children:"Deploy all games, not just changed ones"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--base"})}),(0,r.jsxs)(n.td,{children:["Git ref to diff against (default: ",(0,r.jsx)(n.code,{children:"origin/main"}),")"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--concurrency"})}),(0,r.jsx)(n.td,{children:"Max parallel deploys (default: 3)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--output"})}),(0,r.jsx)(n.td,{children:"Write JSON results to a file"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--limit"})}),(0,r.jsx)(n.td,{children:"Max number of games to deploy"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--logs"})}),(0,r.jsx)(n.td,{children:"Show build/upload logs"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--publish"})}),(0,r.jsx)(n.td,{children:"Publish all deployed places"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--target"})}),(0,r.jsxs)(n.td,{children:["Deploy target name (default: ",(0,r.jsx)(n.code,{children:"test"}),")"]})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Change detection uses ",(0,r.jsx)(n.code,{children:'pnpm ls --filter "...[base]"'})," to find packages (and their dependents) that changed since the base ref, then filters to those with a matching deploy target."]}),"\n",(0,r.jsx)(n.h2,{id:"merging-with-an-existing-place-baseplace",children:"Merging with an existing place (basePlace)"}),"\n",(0,r.jsxs)(n.p,{children:["If your game has content built in Studio (terrain, UI, models) that lives in a team-create place, you don't want rojo to overwrite it. The ",(0,r.jsx)(n.code,{children:"basePlace"})," config solves this \u2014 the CLI downloads the existing place, builds your code separately via rojo, and merges them together before uploading."]}),"\n",(0,r.jsxs)(n.p,{children:["Add ",(0,r.jsx)(n.code,{children:"basePlace"})," to your deploy target:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "targets": {\n    "test": {\n      "universeId": 12345,\n      "placeId": 67890,\n      "project": "default.project.json",\n      "basePlace": {\n        "universeId": 12345,\n        "placeId": 11111\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"basePlace"})," place is the source of truth for Studio-authored content. The target ",(0,r.jsx)(n.code,{children:"placeId"})," is where the merged result gets uploaded. These can be in the same universe or different ones."]}),"\n",(0,r.jsx)(n.h3,{id:"how-the-merge-works",children:"How the merge works"}),"\n",(0,r.jsx)(n.p,{children:"The merge is driven by your rojo project file. Each entry in the tree is treated as one of two kinds:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Graft nodes"})," (has ",(0,r.jsx)(n.code,{children:"$path"})," or ",(0,r.jsx)(n.code,{children:"$className"}),") \u2014 the entire child is replaced with the rojo-built version. This is your code."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Navigation nodes"})," (no ",(0,r.jsx)(n.code,{children:"$path"})," or ",(0,r.jsx)(n.code,{children:"$className"}),") \u2014 the CLI traverses into the existing base service without replacing it. This preserves Studio content like terrain, workspace models, and UI."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This matches how ",(0,r.jsx)(n.code,{children:"rojo serve"})," works: rojo owns the subtrees you point it at and leaves everything else untouched."]}),"\n",(0,r.jsx)(n.h3,{id:"credential-requirements",children:"Credential requirements"}),"\n",(0,r.jsxs)(n.p,{children:["Downloading a base place uses the Roblox Asset Delivery API, which requires the ",(0,r.jsx)(n.code,{children:"legacy-asset:manage"})," scope on your API key in addition to the standard ",(0,r.jsx)(n.code,{children:"universe-places:write"})," scope. See ",(0,r.jsx)(n.a,{href:"/NevermoreEngine/docs/testing/#credential-resolution",children:"Credential resolution"})," for how the CLI finds your API key."]}),"\n",(0,r.jsx)(n.h3,{id:"smoke-testing",children:"Smoke testing"}),"\n",(0,r.jsxs)(n.p,{children:["When ",(0,r.jsx)(n.code,{children:"basePlace"})," is configured, the deploy pipeline automatically runs a smoke test after uploading. The smoke test spawns all ",(0,r.jsx)(n.code,{children:"Script"})," instances in ",(0,r.jsx)(n.code,{children:"ServerScriptService"})," and waits 30 seconds for errors. If any script throws, the deploy is marked as failed. No test assertions are needed \u2014 a clean boot is the test."]}),"\n",(0,r.jsx)(n.h2,{id:"ci-integration",children:"CI integration"}),"\n",(0,r.jsx)(n.h3,{id:"posting-deploy-results-to-a-pr",children:"Posting deploy results to a PR"}),"\n",(0,r.jsxs)(n.p,{children:["After running ",(0,r.jsx)(n.code,{children:"nevermore batch deploy --output results.json"}),", post the results as a PR comment:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"nevermore tools post-deploy-results results.json --run-outcome success\n"})}),"\n",(0,r.jsxs)(n.p,{children:['This creates or updates a PR comment with a table showing each game\'s deploy status and a "Try it" link to the Roblox place. Requires ',(0,r.jsx)(n.code,{children:"GITHUB_TOKEN"})," for PR comments. Job summaries are written automatically when ",(0,r.jsx)(n.code,{children:"GITHUB_STEP_SUMMARY"})," is set."]}),"\n",(0,r.jsx)(n.h3,{id:"automatic-discovery",children:"Automatic discovery"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"nevermore batch deploy"})," discovers games the same way ",(0,r.jsx)(n.code,{children:"nevermore batch test"})," discovers test packages \u2014 by scanning pnpm workspaces for ",(0,r.jsx)(n.code,{children:"deploy.nevermore.json"})," files with the specified target. Any directory under ",(0,r.jsx)(n.code,{children:"games/"})," (or anywhere in the workspace) with a valid config is picked up automatically."]}),"\n",(0,r.jsx)(n.h2,{id:"luau-template-convention",children:"Luau template convention"}),"\n",(0,r.jsxs)(n.p,{children:["Luau scripts that run in Roblox contexts (smoke tests, transforms, templates) should be stored as ",(0,r.jsx)(n.code,{children:".luau"})," files in ",(0,r.jsx)(n.code,{children:"build-scripts/"})," directories \u2014 not generated inline from TypeScript. This keeps Luau code editable, lintable, and follows the pattern established by ",(0,r.jsx)(n.code,{children:"studio-bridge/build-scripts/"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(96540);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);