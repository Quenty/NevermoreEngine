"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[39268],{26531:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"conventions/typescript","title":"TypeScript Conventions","description":"CLI tools under tools/ are TypeScript ESM packages using yargs for command parsing. This guide covers the patterns and conventions for working on these tools.","source":"@site/docs/conventions/typescript.md","sourceDirName":"conventions","slug":"/conventions/typescript","permalink":"/NevermoreEngine/docs/conventions/typescript","draft":false,"unlisted":false,"editUrl":"https://github.com/Quenty/NevermoreEngine/edit/main/docs/conventions/typescript.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"TypeScript Conventions","sidebar_position":2},"sidebar":"defaultSidebar","previous":{"title":"Luau Conventions","permalink":"/NevermoreEngine/docs/conventions/luau"},"next":{"title":"IDE Setup","permalink":"/NevermoreEngine/docs/ides/"}}');var o=r(74848),t=r(28453);const i={title:"TypeScript Conventions",sidebar_position:2},c="TypeScript Conventions",l={},d=[{value:"Project structure",id:"project-structure",level:2},{value:"Building",id:"building",level:3},{value:"ESM imports",id:"esm-imports",level:3},{value:"Naming conventions",id:"naming-conventions",level:2},{value:"Async suffix",id:"async-suffix",level:3},{value:"<code>try*</code> for best-effort operations",id:"try-for-best-effort-operations",level:3},{value:"Private members",id:"private-members",level:3},{value:"Command pattern",id:"command-pattern",level:2},{value:"Subcommands",id:"subcommands",level:3},{value:"Error handling",id:"error-handling",level:2},{value:"Interactive fallback",id:"interactive-fallback",level:3},{value:"Output",id:"output",level:2},{value:"Dryrun support",id:"dryrun-support",level:2},{value:"Process execution",id:"process-execution",level:2},{value:"Other conventions",id:"other-conventions",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"typescript-conventions",children:"TypeScript Conventions"})}),"\n",(0,o.jsxs)(n.p,{children:["CLI tools under ",(0,o.jsx)(n.code,{children:"tools/"})," are TypeScript ESM packages using yargs for command parsing. This guide covers the patterns and conventions for working on these tools."]}),"\n",(0,o.jsx)(n.h2,{id:"project-structure",children:"Project structure"}),"\n",(0,o.jsxs)(n.p,{children:["Each CLI tool is a standalone package under ",(0,o.jsx)(n.code,{children:"tools/"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"tools/\n  nevermore-cli/\n    src/\n      commands/          # yargs CommandModule classes\n      utils/             # exported helper functions\n    package.json         # defines build, build:watch, build:clean scripts\n    tsconfig.json\n"})}),"\n",(0,o.jsx)(n.h3,{id:"building",children:"Building"}),"\n",(0,o.jsxs)(n.p,{children:["Always use npm scripts, never ",(0,o.jsx)(n.code,{children:"tsc"})," directly:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd tools/nevermore-cli && npm run build        # Compile TypeScript\ncd tools/nevermore-cli && npm run build:watch   # Watch mode\ncd tools/nevermore-cli && npm link              # Install globally for local testing\n"})}),"\n",(0,o.jsx)(n.h3,{id:"esm-imports",children:"ESM imports"}),"\n",(0,o.jsxs)(n.p,{children:["All local imports use ",(0,o.jsx)(n.code,{children:".js"})," extension (TypeScript compiles ",(0,o.jsx)(n.code,{children:".ts"})," to ",(0,o.jsx)(n.code,{children:".js"}),", so imports must reference the output):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import { loadDeployConfigAsync } from "./deploy-config.js";\n'})}),"\n",(0,o.jsx)(n.h2,{id:"naming-conventions",children:"Naming conventions"}),"\n",(0,o.jsx)(n.h3,{id:"async-suffix",children:"Async suffix"}),"\n",(0,o.jsxs)(n.p,{children:["Async functions are named with ",(0,o.jsx)(n.code,{children:"Async"})," suffix to make it visually clear they return promises and yield:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// Good: clear that these yield\nasync function uploadPlaceAsync(placeId: number): Promise<void> { ... }\nasync function pollTaskCompletionAsync(taskId: string): Promise<TaskResult> { ... }\n\n// Bad: hidden async behavior\nasync function uploadPlace(placeId: number): Promise<void> { ... }\n"})}),"\n",(0,o.jsxs)(n.h3,{id:"try-for-best-effort-operations",children:[(0,o.jsx)(n.code,{children:"try*"})," for best-effort operations"]}),"\n",(0,o.jsxs)(n.p,{children:["Functions that can fail gracefully use a ",(0,o.jsx)(n.code,{children:"try*"})," prefix and return a result structure instead of throwing:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"// Returns a result object \u2014 caller decides what to do\nasync function tryRenamePlaceAsync(placeId: number): Promise<{\n    success: boolean;\n    reason?: string;\n}> { ... }\n\n// Reserve throwing for operations where failure should halt the caller\nasync function uploadPlaceAsync(placeId: number): Promise<void> {\n    // throws on failure\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"private-members",children:"Private members"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"_"})," prefix for private fields and methods, matching the Luau convention:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"private _connectedClient: Client;\nprivate _rateLimiter: RateLimiter;\n"})}),"\n",(0,o.jsx)(n.h2,{id:"command-pattern",children:"Command pattern"}),"\n",(0,o.jsxs)(n.p,{children:["Commands are classes implementing ",(0,o.jsx)(n.code,{children:"CommandModule<T, ArgsInterface>"})," from yargs:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'import type { CommandModule } from "yargs";\n\ninterface DeployRunArgs {\n    target: string;\n    publish: boolean;\n    dryrun: boolean;\n}\n\nconst deployRunCommand: CommandModule<{}, DeployRunArgs> = {\n    command: "run [target]",\n    describe: "Build and upload via Open Cloud",\n    builder: (args) => args\n        .positional("target", { type: "string", default: "test" })\n        .option("publish", { type: "boolean", default: false })\n        .option("dryrun", { type: "boolean", default: false }),\n    handler: async (args) => {\n        try {\n            await deployRunAsync(args);\n        } catch (err) {\n            OutputHelper.error(formatError(err));\n            process.exit(1);\n        }\n    },\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"subcommands",children:"Subcommands"}),"\n",(0,o.jsxs)(n.p,{children:["Use nested ",(0,o.jsx)(n.code,{children:"args.command()"})," calls in the builder. Use ",(0,o.jsx)(n.code,{children:"$0"})," alias for the default subcommand. See ",(0,o.jsx)(n.code,{children:"deploy-command.ts"})," for the ",(0,o.jsx)(n.code,{children:"deploy init"})," / ",(0,o.jsx)(n.code,{children:"deploy run"})," pattern."]}),"\n",(0,o.jsx)(n.h2,{id:"error-handling",children:"Error handling"}),"\n",(0,o.jsxs)(n.p,{children:["Command handlers wrap logic in try/catch, format with ",(0,o.jsx)(n.code,{children:"OutputHelper.error()"}),", and call ",(0,o.jsx)(n.code,{children:"process.exit(1)"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'// Good: actionable error with context\nOutputHelper.error(`Failed to upload place ${placeId}: ${err.message}`);\nOutputHelper.hint("Check that your API key has the universe-places:write scope");\nOutputHelper.hint("Run \'nevermore login --status\' to verify credentials");\nprocess.exit(1);\n\n// Bad: raw error reaching the user\nthrow err;  // user sees "Error: Request failed with status code 403" + stack trace\n'})}),"\n",(0,o.jsx)(n.p,{children:"Error messages should be actionable \u2014 include what went wrong, what scope/permission is needed, and links or commands to fix it."}),"\n",(0,o.jsx)(n.h3,{id:"interactive-fallback",children:"Interactive fallback"}),"\n",(0,o.jsxs)(n.p,{children:["When credentials are missing in interactive mode, prompt inline rather than erroring. Only throw in ",(0,o.jsx)(n.code,{children:"--yes"})," (CI) mode."]}),"\n",(0,o.jsx)(n.h2,{id:"output",children:"Output"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"OutputHelper"})," from ",(0,o.jsx)(n.code,{children:"@quenty/cli-output-helpers"})," for all terminal output:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:'OutputHelper.info("Building rojo project...");\nOutputHelper.warn("Place file is older than 1 hour");\nOutputHelper.error("API key is invalid");\nOutputHelper.hint("Run \'nevermore login\' to set up credentials");\n'})}),"\n",(0,o.jsx)(n.h2,{id:"dryrun-support",children:"Dryrun support"}),"\n",(0,o.jsxs)(n.p,{children:["Thread the ",(0,o.jsx)(n.code,{children:"args"})," object through to helpers. For subprocess calls, ",(0,o.jsx)(n.code,{children:"runCommandAsync()"})," handles dryrun automatically. For API calls, log-and-skip:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"if (args.dryrun) {\n    OutputHelper.info(`[dryrun] Would upload place to ${placeId}`);\n    return;\n}\nawait uploadPlaceAsync(placeId, apiKey);\n"})}),"\n",(0,o.jsx)(n.h2,{id:"process-execution",children:"Process execution"}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"runCommandAsync()"})," from ",(0,o.jsx)(n.code,{children:"nevermore-cli-utils.ts"})," to spawn child processes (wraps ",(0,o.jsx)(n.code,{children:"execa"}),"). For rojo builds specifically, always use ",(0,o.jsx)(n.code,{children:"rojoBuildAsync"})," from ",(0,o.jsx)(n.code,{children:"@quenty/nevermore-template-helpers"})," \u2014 never invoke rojo directly via ",(0,o.jsx)(n.code,{children:"execa"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"other-conventions",children:"Other conventions"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Fail fast"}),": Validate credentials and config before expensive operations (e.g., check API key before rojo build)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Utils = exported functions"}),": Utility modules export standalone async functions, not classes. See ",(0,o.jsx)(n.code,{children:"open-cloud-client.ts"}),", ",(0,o.jsx)(n.code,{children:"credential-store.ts"}),", ",(0,o.jsx)(n.code,{children:"deploy-config.ts"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"No header comments"}),": Using separating comments to delimit areas implies these should be split into separate files or classes"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"No section comment headers"}),": Don't use ",(0,o.jsx)(n.code,{children:"// --- Section ---"})," style dividers. Code organization should be self-evident from structure"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Platform-specific code in separate files"}),": When code varies by OS, split into a folder with per-platform files (e.g., ",(0,o.jsx)(n.code,{children:"roblox-auth/windows.ts"}),", ",(0,o.jsx)(n.code,{children:"roblox-auth/macos.ts"}),") re-exported through ",(0,o.jsx)(n.code,{children:"index.ts"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"No co-authorship"}),": Do not include ",(0,o.jsx)(n.code,{children:"Co-Authored-By"})," on Nevermore commits (open source repo)"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>c});var s=r(96540);const o={},t=s.createContext(o);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);